= Migrate application from JBoss EAP 7.4 to {{ EAP8_VERSION }}
:experimental:
:imagesdir: images

{{ EAP8_VERSION }} requires code changes to applications written for JBoss EAP 7.4. Due to the move from Jakarta 8 to Jakarta 10.  

== Using the Migration Toolkit for Runtimes VS Code extension

To perform the required code changes, we're going to use the Migration Toolkit for Runtimes VS Code extension.  To use this we will need to deploy the Migration Toolkit for Runtimes Command Line Tool.

We have provided a zip distribution of the CLI tool in the "/shared" folder

First we need to unzip the Migration Toolkit for Runtimes CLI tool

[source,sh,role="copypaste"]
----
cd /shared
----

[source,sh,role="copypaste"]
----
unzip {{ MTR_CLI_ARCHIVE }} 
----

Configure the MTR VS-Code extension as follows

image::mtr-vscode-2.png[migration,800]

* Set code location to "/projects/workshop/coolstore"
* Ensure "eap8" is selected under "--target" 

To perform the code analysis, click on the start button as shown below

image::mtr-vscode-3.png[migration,400]

Once the analysis is complete, you should see a file hierachy in the left hand window.  

At the top of the file hierarchy is a report icon (in greeen).  Click on this to view the HTML version of the report.

image::mtr-report.png[mtr-report,800]

Clicking on a file will open up the editor showing where the issues are with the file.

Click on "coolstore" in the report, and then select the "Issues" tab to view the details of the migration.

image::mtr-report-issues.png[mtr-report-issues,800]

You can also select a file from the hierarchy examine in the issues in the code.

image::mtr-vscode-4.png[migration,800]

You can make the edits directly in the file as indicated, or in most cases you can right click on the file and select "Apply all quickfixes"

You can also apply all the quickfixes to the code base by right clicking on "workshop" at the top of the hierarchy and clicking on "Apply all guickfixes".

image::mtr-vscode-5.png[migration,400]

Once you've completed the namespace changes, there is one more minor code change to make:

Open "/projects/workshop/coolstore/src/main/java/com/redhat/coolstore/service/OrderServiceMDB.java/OrderServiceMDB.java" and change

[source,java]
----
@ActivationConfigProperty(propertyName = "destinationType", propertyValue = "javax.jms.Topic")
----

to 
[source,java,role="copypaste"]
----
@ActivationConfigProperty(propertyName = "destinationType", propertyValue = "jakarta.jms.Topic"),
----

== Remaining file changes

Other than the namespace changes, the migration toolkit for runtimes report identified changes in the pom.xml file.

We can go through the changes as detailed in the report, or copy these files from a pre-prepared {{ EAP8_VERSION }} version of the app in the /projects//sample-app-eap8 folder by running the following commands.

[source,sh,role="copypaste"]
----
cp /projects/workshop/coolstore-eap8/pom.xml /projects/workshop/coolstore
----

We can now deploy our {{ EAP8_VERSION }} application

[source,sh,role="copypaste"]
----
cd /projects/workshop/coolstore
----

[source,sh,role="copypaste"]
----
mvn clean package
----

[source,sh,role="copypaste"]
----
/shared/jboss-eap-8.0/bin/jboss-cli.sh --connect --controller=127.0.0.1:10190
----

Run the following command to deploy the application:

[source,sh,role="copypaste"]
----
deploy ./target/ROOT.war
----

You will now be able to access the application by by clicking http://{{ USER_ID }}-jboss-workshop-eap8.{{ ROUTE_SUBDOMAIN }}[here, window="_blank"]

The coolstore application should load as follows

image::coolstore.png[public-endpoint,800]

We've now successfully deployed our sample application to {{ EAP8_VERSION }} connecting to an external PostgreSQL database.

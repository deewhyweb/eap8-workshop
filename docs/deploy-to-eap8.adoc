= Migrate application from JBoss EAP 7.4 to {{ EAP8_VERSION }}
:experimental:
:imagesdir: images

{{ EAP8_VERSION }} requires code changes to applications written for JBoss EAP 7.4. Due to the move from Jakarta 8 to Jakarta 10 (e.g., converting from the “javax” namespace to “jakarta” namespace). These changes are documented in this https://access.redhat.com/articles/6980265[article, window="_blank"]. 

== Using the Migration Toolkit for Runtimes VS Code extension

To perform the required code changes, we're going to use the Migration Toolkit for Runtimes VS Code extension.  To use this we will need to deploy the Migration Toolkit for Runtimes Command Line Tool.

We have provided a zip distribution of the CLI tool in the "/shared" folder

*Step 1:* First we need to unzip the Migration Toolkit for Runtimes CLI tool

[source,sh,role="copypaste"]
----
cd /shared & unzip {{ MTR_CLI_ARCHIVE }} 
----

*Step 2:* Configure the MTR VS-Code extension as follows

image::mtr-vscode-2.png[migration,800]

* Set code location to "/projects/workshop/coolstore"
* Ensure "eap8" is selected under "--target" 

*Step 3:* To perform the code analysis, click on the start button as shown below

image::mtr-vscode-3.png[migration,400]

Once the analysis is complete, you should see a file hierachy in the left hand window.  

*Step 4:* At the top of the file hierarchy is a report icon (in greeen).  Click on this to view the HTML version of the report.

image::mtr-report.png[mtr-report,800]

Clicking on a file will open up the editor showing where the issues are with the file.

*Step 5:* Click on "coolstore" in the report, and then select the "Issues" tab to view the details of the migration.

image::mtr-report-issues.png[mtr-report-issues,800]

*Step 6:* You can also select a file from the hierarchy examine in the issues in the code.

image::mtr-vscode-4.png[migration,800]

*Step 7:* You can make the edits directly in the file as indicated, or in most cases you can right click on the file and select "Apply all quickfixes"

You can also apply all the quickfixes to the code base by right clicking on "workshop" at the top of the hierarchy and clicking on "Apply all guickfixes".

image::mtr-vscode-5.png[migration,400]

Once you've completed the namespace changes, there is one more minor code change to make:

*Step 8:* Open "/projects/workshop/coolstore/src/main/java/com/redhat/coolstore/service/OrderServiceMDB.java/OrderServiceMDB.java" and change

[source,java]
----
@ActivationConfigProperty(propertyName = "destinationType", propertyValue = "javax.jms.Topic")
----

to 
[source,java,role="copypaste"]
----
@ActivationConfigProperty(propertyName = "destinationType", propertyValue = "jakarta.jms.Topic"),
----

== Remaining file changes

Other than the namespace changes, the Migration Toolkit for Runtimes report identified changes in the pom.xml file.

*Step 9:* We can go through the changes as detailed in the report, or copy these files from a pre-prepared {{ EAP8_VERSION }} version of the app in the /projects/sample-app-eap8 folder by running the following commands.

[source,sh,role="copypaste"]
----
cp /projects/workshop/coolstore-eap8/pom.xml /projects/workshop/coolstore
----

*Step 10:* We can now build our {{ EAP8_VERSION }} application

[source,sh,role="copypaste"]
----
cd /projects/workshop/coolstore  mvn clean package
----

*Step 11:* Login to the JBoss CLI

[source,sh,role="copypaste"]
----
$EAP8_HOME/bin/jboss-cli.sh --connect --controller=127.0.0.1:10190
----

You will be prompted to enter the {{ EAP8_VERSION }} admin credentials.  

username: admin
password: password

*Step 12:* We can now deploy our {{ EAP8_VERSION }} application

Run the following command to deploy the application:

[source,sh,role="copypaste"]
----
deploy ./target/ROOT.war
----

You will now be able to access the application by by clicking https://{{ USER_ID }}-jboss-workshop-eap8.{{ ROUTE_SUBDOMAIN }}[here, window="_blank"]

The coolstore application should load as follows

image::coolstore.png[public-endpoint,800]

== Push our changes to Gitea

Before we move on, we need to push our code changes to our gitea repository.

*Step 13:* Click on the "Source Control" icon in the IDE, you should see the following:

image::git-eap8-1.png[source-contol]

*Step 14:* Enter a commit message in the message field and click on the "Commit" button.

You will be prompted to stage files to the commit

image::git-2.png[stage-files]

*Step 15:* Click on "Yes" and then click on "Sync Changes" to push your changes to gitea

You will be prompted to enter a username:

image::git-3.png[git-username]

*Step 16:* Enter `{{ USER_ID }}`

You will then be prompted for a password:

*Step 17:* Enter `{{ CHE_USER_PASSWORD }}`

Your changes will be pushed to gitea.

We've now successfully migrated our sample application from JBoss EAP 7.4 to {{ EAP8_VERSION }} connecting to an external PostgreSQL database.
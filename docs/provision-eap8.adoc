= Traditional app deployment on JBoss 7.4
:experimental:
:imagesdir: images

{{ EAP8_VERSION }} will provide support for https://jakarta.ee/release/10/[Jakarta EE 10]. Jakarta EE 10 brings a huge change to Jakarta EE compared to the Jakarta EE 8 specifications supported by EAP 7. {{ EAP8_VERSION }} also introduces changes in the following areas:

* Removal of Picketbox: This has been deprecated since the release of JBoss EAP 6.4. Any legacy security configurations must be migrated to the Elytron security subsystem. EAP users who have already migrated to Elytron don't need to make any changes.
* Removal of PicketLink: This has been deprecated since the release of JBoss EAP 6.4. Leveraging RH SSO is recommended for the single sign-on functionality previously offered with PicketLink.
Support for OpenID Connect (OIDC) will now be provided by the elytron-oidc-client subsystem instead of the separate RH-SSO OIDC adapter.
* SAML support is provided by the RH-SSO SAML adapter (Picketlink SAML has been removed). In JBoss EAP 8.0 GA, support for SAML will be provided by a new RH-SSO SAML Galleon Feature Pack.
* Hibernate 6.x: Read the https://docs.jboss.org/hibernate/search/6.0/migration/html_single/[Hibernate Search article] for guidance on migrating from 5.11.x to 6.0.x.
* Removal of JDK 8: JDK 11 or JDK 17 is now required.
* Jolokia and Prometheus removed: Red Hat will no longer support these features. JBoss EAP server exposes metrics through the server metrics endpoint: <server address>:<management port>/metrics.
Apache Log4j version 1 APIs removed: If your applications do not package log4j.jar and Log4j configuration as part of the application, then you must update them.
* New maven plugin: The new eap-maven-plugin uses Galleon technology to build the server based on the layer configuration needed in your application. This results in a reduced size and memory footprint, plus a reduced attack surface. If the JAR impacted by a CVE is not present, EAP will not be vulnerable to the CVE. The JBoss EAP 8 OpenShift images don’t contain EAP runtime binaries like it used to in EAP 6 and EAP 7. This plugin also supports the execution of JBoss EAP CLI script files to customize your server configuration. OpenShift Source to Image builds (S2I) incorporate this change and have been redesigned to leverage the eap-maven-plugin to create the server. You can find more information in the https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/8.0-beta/[documentation].
* Bridge deploy fail: Previously, if a bridge were misconfigured, you wouldn’t know until you tried to use it. Now, the bridge will fail when added if it fails to deploy.

Refer to the https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/8-beta/html/release_notes_for_red_hat_jboss_enterprise_application_platform_8.0_beta/index[release notes] for more information about the changes introduced in this beta release.

Moving applications from JBoss EAP 7.4 to JBoss EAP 8.0 Beta will require code changes due to the move from Jakarta EE 8 to Jakarta EE 10 (e.g., converting from the “javax” namespace to “jakarta” namespace). These changes are documented in this https://access.redhat.com/articles/6980265[article]. To help our customers with this migration effort we've updated our tools: the https://developers.redhat.com/products/mta/download[Migration Toolkit for Applications], including the Migration Toolkit for Runtimes (MTR, for non-OpenShift projects) and the JBoss EAP Server Migration tool. 

In this section we're going to use the JBoss EAP Server Migration tool migrate the server configuration from JBoss EAP 7.4 to {{ EAP8_VERSION }}

We now have a running instance of our application running in JBoss EAP 7.4 ready to migrate to {{ EAP8_VERSION }}. Before starting the migration, shut down the JBoss EAP 7.4 server and create an environment variable pointing to the JBoss EAP 7.4 deployment.

If JBoss EAP 7.4 is still running, switch to this tab and press CTRL + C to stop the server

[source,sh,role="copypaste"]
----
export EAP_PREVIOUS_HOME=/shared/{{ JBOSS7_DIR }}
----


You will find a {{ EAP8_VERSION }} archive in the "/shared" folder.  From the terminal enter the following commands:

[source,sh,role="copypaste"]
----
cd /shared
----

[source,sh,role="copypaste"]
----
unzip {{ JBOSS8_ARCHIVE }} 
----

Extract the distribution into a local folder (e.g., ~/jboss-eap-8).  

Set the EAP_HOME environment variable as follows:

[source,sh,role="copypaste"]
----
export EAP_HOME=/shared/{{ JBOSS8_DIR }} 
----

Now we can move on to the migration from JBoss EAP 7.4 to {{ EAP8_VERSION }}.

## Server configuration changes
When we deployed our application to JBoss EAP 7.4, we made some changes to the server configuration to add a module and driver to connect to MySQL. We must ensure these modules and drivers are in place and working correctly in our {{ EAP8_VERSION }} server. We can use the JBoss EAP server migration tool to perform this migration for us.  

[source,sh,role="copypaste"]
----
cd /shared
----

[source,sh,role="copypaste"]
----
unzip {{ SERVER_MIGRATION_ARCHIVE }}
----

[source,sh,role="copypaste"]
----
cd {{ SERVER_MIGRATION_DIR }}
----

Run the following command:

[source,sh,role="copypaste"]
----
./jboss-server-migration.sh -s $EAP_PREVIOUS_HOME -t $EAP_HOME
----

The server migration tool will ask a series of questions during the migration process:

image::mig1.png[migration,1150]
Choose yes to migrate the standalone configuration.

image::mig2.png[migration,1150]
Choose no. We want to select the configurations to migrate.

image::mig3.png[migration,1150]
Choose yes. We want to migrate standalone-full-ha.xml.

image::mig4.png[migration,1150]
Choose no. We don’t want to migrate standalone-full.xml

image::mig5.png[migration,1150]
Choose no. We don’t want to migrate standalone-ha.xml.

image::mig6.png[migration,1150]
Choose no. We don’t want to migrate standalone-load-balancer.xml.

image::mig7.png[migration,1150] 
Choose no. We don't want to migrate standalone.xml.

image::mig8.png[migration,1150]
Choose no. We are not using a managed domain.

image::mig9.png[migration,1150]

Once this operation completes, we can start our {{ EAP8_VERSION }} server with the following command from the JBoss EAP installation folder:

[source,sh,role="copypaste"]
----
$EAP_HOME/bin/standalone.sh  -c standalone-full-ha.xml  -Djboss.http.port=8100 -b 0.0.0.0
----

You should now be able to access the EAP 8 landing page by clicking http://{{ USER_ID }}-jboss-workshop-eap8.{{ ROUTE_SUBDOMAIN }}[here, window="_blank"]


When the server has started successfully, we can test our configuration with the following commands.

Open a new terminal window and enter:

[source,sh,role="copypaste"]
----
export EAP_HOME=/shared/{{ JBOSS8_DIR }} 
----


[source,sh,role="copypaste"]
----
$EAP_HOME/bin/jboss-cli.sh --connect
----

[source,sh,role="copypaste"]
----
/subsystem=datasources:installed-drivers-list
----

The output should show the PostgreSQL driver as follows:
[source]
----
{
    "outcome" => "success",
    "result" => [
        {
            "driver-name" => "postgresql",
            "deployment-name" => undefined,
            "driver-module-name" => "org.postgresql",
            "module-slot" => "main",
            "driver-datasource-class-name" => "",
            "driver-xa-datasource-class-name" => "",
            "datasource-class-info" => undefined,
            "driver-class-name" => "org.postgresql.Driver",
            "driver-major-version" => 42,
            "driver-minor-version" => 6,
            "jdbc-compliant" => false
        },
        {
            "driver-name" => "h2",
            "deployment-name" => undefined,
            "driver-module-name" => "com.h2database.h2",
            "module-slot" => "main",
            "driver-datasource-class-name" => "",
            "driver-xa-datasource-class-name" => "org.h2.jdbcx.JdbcDataSource",
            "datasource-class-info" => [{"org.h2.jdbcx.JdbcDataSource" => {
                "URL" => "java.lang.String",
                "description" => "java.lang.String",
                "loginTimeout" => "int",
                "password" => "java.lang.String",
                "url" => "java.lang.String",
                "user" => "java.lang.String"
            }}],
            "driver-class-name" => "org.h2.Driver",
            "driver-major-version" => 2,
            "driver-minor-version" => 1,
            "jdbc-compliant" => true
        }
    ]
}
----

We can also test our datasource connection with the following JBoss CLI command:

[source,sh,role="copypaste"]
----
/subsystem=datasources/data-source=postgresql:test-connection-in-pool
----

A successful connection should result in the following response:
[source]
----
{

    "outcome" => "success",

    "result" => [true]

}
----
We can now be confident our application will have the required drivers and data sources present.

{{ EAP8_VERSION }} is now successfully deployed and the server configuration migrated from JBoss EAP 7.4